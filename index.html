<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboard YES 2025</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tom Select CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.bootstrap5.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .kpi { background: white; padding: 1rem; border-radius: 0.5rem; box-shadow: 0 1px 6px rgba(0,0,0,.06) }
    .ts-wrap { min-width: 200px; }
    .table-scroll { max-height: 360px; overflow:auto; }

    /* TomSelect fixes */
    .ts-wrapper, .tom-select, .tom-select .ts-control, .tom-select .ts-control .items, .tom-select .ts-control input {
      background-color: #fff !important;
      color: inherit !important;
      border-radius: 0.375rem !important;
    }
    .tom-select .ts-control {
      border: 1px solid rgba(148,163,184,0.35) !important;
      padding: 0.35rem 0.5rem !important;
      box-shadow: none !important;
    }
    .tom-select .ts-control .item {
      background: #e6eef8 !important;
      color: #03396c !important;
      margin-right: 6px !important;
    }
    .ts-dropdown, .tom-select .ts-dropdown, .tom-select .ts-dropdown .ts-option {
      background-color: #fff !important;
      color: #111 !important;
    }
    .ts-dropdown, .tom-select .ts-dropdown {
      position: absolute !important;
      z-index: 99999 !important;
      box-shadow: 0 8px 30px rgba(2,6,23,0.12) !important;
      border-radius: 0.5rem !important;
      max-height: 320px !important;
      overflow: auto !important;
    }
    .tom-select, .ts-wrapper { overflow: visible !important; }

    /* Skeleton & loading overlay */
    #loading-overlay {
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(255,255,255,0.6); z-index: 100000;
    }
    .skeleton {
      background: linear-gradient(90deg, rgba(0,0,0,0.04) 25%, rgba(0,0,0,0.06) 37%, rgba(0,0,0,0.04) 63%);
      background-size: 400% 100%;
      animation: shine 1.4s ease infinite;
      border-radius: 8px;
    }
    @keyframes shine { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .kpi-skel { height: 56px; width: 100%; }
    .chart-skel { height: 220px; width: 100%; margin-bottom: 1rem; }
    .table-row-skel { height: 40px; width: 100%; margin-bottom: 6px; border-radius: 6px; }
  </style>
</head>
<body class="bg-slate-50">

<div class="max-w-7xl mx-auto">
  <!-- Header -->
  <header class="bg-white border-b">
    <div class="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-semibold">Dashboard YES 2025</h1>
      </div>
      <div class="flex items-center gap-4">
        <a href="form.html" class="inline-flex items-center gap-2 border border-sky-500 text-sky-600 px-4 py-2 rounded-md hover:bg-sky-50">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
          </svg>
          Input Form
        </a>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-6 py-6">
    <!-- Filters -->
    <section class="space-y-4 mb-6">
      <div>
        <label for="select-periode" class="block text-sm font-medium text-slate-700 mb-2">Periode</label>
        <select id="select-periode" class="w-full rounded-md border border-slate-200 p-3" placeholder="Filter Periode"></select>
      </div>
      <div>
        <label for="select-tags" class="block text-sm font-medium text-slate-700 mb-2">Wilayah</label>
        <select id="select-tags" multiple class="w-full rounded-md border border-slate-200 p-3" placeholder="Filter Wilayah"></select>
      </div>
      <div>
        <label for="select-nama" class="block text-sm font-medium text-slate-700 mb-2">Nama PM</label>
        <select id="select-nama" multiple class="w-full rounded-md border border-slate-200 p-3 bg-slate-50" placeholder="Pilih Wilayah terlebih dahulu"></select>
      </div>
      <div class="flex gap-3 items-center">
        <button id="btn-refresh" class="px-4 py-2 rounded bg-blue-600 text-white">Refresh</button>
        <button id="btn-reset" class="px-4 py-2 rounded bg-gray-200 text-slate-700">Reset</button>
        <button id="btn-autoref" class="px-4 py-2 rounded bg-green-600 text-white">Start Auto</button>
        <div class="ml-auto flex items-center gap-2">
          <label class="text-sm text-slate-600">Auto interval (s)</label>
          <input id="auto-interval" type="number" value="30" min="5" class="w-20 p-2 border rounded" />
        </div>
      </div>
    </section>

    <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">Ketentuan Skor Indikator</h3>
        <table class="w-full text-sm">
          <tbody>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">Skor 4</td><td class="p-1">Selalu, Sangat menguasai, 80% - 100% tercapai / ada</td></tr>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">Skor 3</td><td class="p-1">Sering, Menguasai, 65% - 79% tercapai / ada</td></tr>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">Skor 2</td><td class="p-1">Kadang-kadang, Cukup menguasai, 55% - 64% tercapai ada</td></tr>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">Skor 1</td><td class="p-1">Jarang, Kurang menguasai, 40% - 54% tercapai / ada</td></tr>
            <tr><td class="p-1 font-medium bg-slate-50">Skor 0</td><td class="p-1">Tidak pernah, Tidak menguasai, <40% tercapai / ada</td></tr>
          </tbody>
        </table>
      </div>
      <div class="bg-white p-4 rounded shadow">
        <h3 class="font-semibold mb-2">Kategori Grade (Nilai Total)</h3>
        <table class="w-full text-sm">
          <tbody>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">100</td><td class="p-1">Excellent (Sempurna / Istimewa)</td></tr>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">90-99</td><td class="p-1">Very Good (Baik Sekali)</td></tr>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">80-89</td><td class="p-1">Good (Baik)</td></tr>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">70-79</td><td class="p-1">Satisfactory (Cukup)</td></tr>
            <tr class="border-b"><td class="p-1 font-medium bg-slate-50">50-69</td><td class="p-1">Need Improvement (Kurang Baik)</td></tr>
            <tr><td class="p-1 font-medium bg-slate-50">< 50</td><td class="p-1">Below Standart (Lemah)</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- KPI row (4 cards) -->
      <section id="kpi-row" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="kpi">
          <div class="text-sm text-slate-500">Wilayah Terfilter</div>
          <div id="kpi-wilayah-count" class="text-2xl font-bold">—</div>
          <!-- <div class="text-xs text-slate-400 mt-1">Jumlah wilayah</div> -->
        </div>
        
        <div class="kpi">
          <div class="text-sm text-slate-500">Jumlah Data</div>
          <div id="kpi-total-dinilai" class="text-2xl font-bold">—</div>
          <!-- div id="kpi-total-dinilai-sub" class="text-xs text-slate-400 mt-1"></div> -->
        </div>

        <div class="kpi">
          <div class="text-sm text-slate-500">Nilai Rata-Rata Seluruh PM</div>
          <div id="kpi-avg-percent" class="text-2xl font-bold">—</div>
          <!-- <div class="text-xs text-slate-400 mt-1">Rata-rata dari seluruh record</div> -->
        </div>

        <div class="kpi">
          <div class="text-sm text-slate-500">Grade Rata-Rata Seluruh PM</div>
          <div id="kpi-avg-grade" class="text-2xl font-bold">—</div>
          <div id="kpi-avg-grade-sub" class="text-xs text-slate-400 mt-1"></div>
        </div>
      </section>

      <!-- Profile averages (domain) -->
      <section id="profile-averages" class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
        <!-- each card -->
        <div class="kpi text-center">
          <div class="text-sm text-slate-500">Campus Preparation</div>
          <div id="pf-campus" class="text-xl font-semibold">—</div>
          <div id="pf-campus-cat" class="text-xs text-slate-500 mt-1">—</div>
        </div>
        <div class="kpi text-center">
          <div class="text-sm text-slate-500">Akhlak Mulia</div>
          <div id="pf-akhlak" class="text-xl font-semibold">—</div>
          <div id="pf-akhlak-cat" class="text-xs text-slate-500 mt-1">—</div>
        </div>
        <div class="kpi text-center">
          <div class="text-sm text-slate-500">Quranic Mentorship</div>
          <div id="pf-quranic" class="text-xl font-semibold">—</div>
          <div id="pf-quranic-cat" class="text-xs text-slate-500 mt-1">—</div>
        </div>
        <div class="kpi text-center">
          <div class="text-sm text-slate-500">Softskill</div>
          <div id="pf-softskill" class="text-xl font-semibold">—</div>
          <div id="pf-softskill-cat" class="text-xs text-slate-500 mt-1">—</div>
        </div>
        <div class="kpi text-center">
          <div class="text-sm text-slate-500">Leadership</div>
          <div id="pf-leadership" class="text-xl font-semibold">—</div>
          <div id="pf-leadership-cat" class="text-xs text-slate-500 mt-1">—</div>
        </div>
      </section>

      <!-- Tren Nilai per Periode (line) -->
      <div class="p-4 bg-white rounded shadow mb-6">
        <h3 class="font-semibold mb-2">Tren Nilai per Periode</h3>
        <canvas id="chart-trend-periode" height="120"></canvas>
      </div>

      <!-- Rata-rata Nilai per Wilayah (bar) -->
      <div class="p-4 bg-white rounded shadow mb-6">
        <h3 class="font-semibold mb-2">Rata-rata Nilai per Wilayah</h3>
        <canvas id="chart-wilayah" height="140"></canvas>
      </div>

      <!-- Table (ke bawah) - keep same id -->
      <section class="bg-white rounded shadow p-4">
        <h3 class="font-semibold mb-2">Data (klik baris untuk lihat detail)</h3>
        <div class="table-scroll">
          <table id="tbl-data" class="min-w-full text-sm">
            <thead class="bg-slate-100 sticky top-0">
              <tr>
                <th class="p-2 text-left">wilayah</th>
                <th class="p-2 text-left">nama_pm</th>
                <th class="p-2 text-left">periode</th>
                <th class="p-2 text-left">total_skor</th>
                <th class="p-2 text-left">grade</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
  </main>

  <!-- modal detail -->
  <div id="modal" class="fixed inset-0 hidden items-center justify-center bg-black/40">
    <div class="bg-white rounded p-4 w-11/12 max-w-2xl">
      <div class="flex justify-between items-center mb-2">
        <h4 class="font-semibold">Detail Penilaian</h4>
        <button id="modal-close" class="text-slate-600">✕</button>
      </div>
      <div id="modal-body" class="text-sm max-h-96 overflow-auto"></div>
    </div>
  </div>
</div>

<!-- Tom Select JS -->
<script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
<!-- main script -->

<!-- jsPDF, AutoTable, html2canvas for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script type="module" src="./main.js"></script>
</body>
</html>
